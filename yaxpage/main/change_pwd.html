<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  >
  <title>修改密码 - 智慧校园系统</title>
  <link
    rel="stylesheet"
    href="./css/font-awesome.min.css"
  >
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #3b82f6 100%);
      position: relative;
      overflow: hidden;
    }

    /* SVG背景样式 */
    .svg-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .wave-path {
      animation: wave 20s ease-in-out infinite;
    }

    .wave-path:nth-child(2) {
      animation-delay: -5s;
      animation-duration: 25s;
      opacity: 0.7;
    }

    .wave-path:nth-child(3) {
      animation-delay: -10s;
      animation-duration: 30s;
      opacity: 0.5;
    }

    @keyframes wave {

      0%,
      100% {
        d: path("M0,192 C320,300,420,300,740,192 C1060,84,1160,84,1440,192 L1440,320 L0,320 Z");
      }

      50% {
        d: path("M0,84 C320,192,420,192,740,84 C1060,-24,1160,-24,1440,84 L1440,320 L0,320 Z");
      }
    }

    .change-password-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(30, 60, 114, 0.2);
      padding: 40px;
      width: 100%;
      max-width: 450px;
      transition: transform 0.3s ease;
      border: 1px solid rgba(59, 130, 246, 0.1);
      position: relative;
      z-index: 10;
    }

    .change-password-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(30, 60, 114, 0.25);
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header i {
      font-size: 48px;
      color: #2563eb;
      margin-bottom: 15px;
      text-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
    }

    .header h2 {
      color: #1e3a8a;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .header p {
      color: #64748b;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #374151;
      font-weight: 500;
      font-size: 14px;
    }

    .input-group {
      position: relative;
    }

    .form-control {
      width: 100%;
      padding: 12px 45px 12px 15px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: rgba(248, 250, 252, 0.8);
      backdrop-filter: blur(5px);
    }

    .form-control:focus {
      outline: none;
      border-color: #3b82f6;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .input-group i {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .input-group i:hover {
      color: #2563eb;
    }

    .password-requirements {
      margin-top: 8px;
      font-size: 12px;
      color: #6b7280;
    }

    .requirement-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      transition: color 0.3s ease;
    }

    .requirement-item i {
      width: 16px;
      margin-right: 6px;
      font-size: 10px;
    }

    .requirement-met {
      color: #10b981;
    }

    .requirement-unmet {
      color: #ef4444;
    }

    .strength-text {
      font-size: 12px;
      margin-top: 5px;
      color: #6b7280;
      font-weight: 500;
    }

    .strength-weak .strength-text {
      color: #ef4444;
    }

    .strength-medium .strength-text {
      color: #f59e0b;
    }

    .strength-strong .strength-text {
      color: #10b981;
    }

    /* 弹窗样式 */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: white;
      border-radius: 15px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      transform: scale(0.7);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .modal-overlay.show .modal-content {
      transform: scale(1);
      opacity: 1;
    }

    .modal-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .modal-header i {
      font-size: 48px;
      color: #ef4444;
      margin-bottom: 15px;
    }

    .modal-header h3 {
      color: #1f2937;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .modal-body {
      margin-bottom: 25px;
    }

    .modal-body p {
      color: #6b7280;
      line-height: 1.6;
      margin-bottom: 15px;
    }

    .modal-requirements {
      background: #f9fafb;
      border-radius: 8px;
      padding: 15px;
      border-left: 4px solid #ef4444;
    }

    .modal-requirements .requirement-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      font-size: 14px;
      color: #374151;
    }

    .modal-requirements .requirement-item:last-child {
      margin-bottom: 0;
    }

    .modal-requirements .requirement-item i {
      width: 16px;
      margin-right: 8px;
      color: #ef4444;
    }

    .modal-footer {
      text-align: center;
    }

    .modal-btn {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 30px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(239, 68, 68, 0.2);
    }

    .modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(239, 68, 68, 0.3);
    }

    .password-strength {
      margin-top: 8px;
      height: 4px;
      border-radius: 2px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .password-strength-bar {
      height: 100%;
      width: 0%;
      transition: all 0.3s ease;
      border-radius: 2px;
    }

    .strength-weak {
      background: #ef4444;
      width: 33%;
    }

    .strength-medium {
      background: #f59e0b;
      width: 66%;
    }

    .strength-strong {
      background: #10b981;
      width: 100%;
    }

    .strength-text {
      font-size: 12px;
      margin-top: 5px;
      color: #6b7280;
    }

    .btn-submit {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #2563eb 0%, #3b82f6 50%, #1d4ed8 100%);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
    }

    .btn-submit:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(37, 99, 235, 0.3);
    }

    .btn-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .error-message {
      color: #ef4444;
      font-size: 12px;
      margin-top: 5px;
      display: none;
    }

    .success-message {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 20px;
      display: none;
      box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
    }

    .back-link {
      text-align: center;
      margin-top: 20px;
    }

    .back-link a {
      color: #2563eb;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.3s ease;
      font-weight: 500;
    }

    .back-link a:hover {
      color: #1d4ed8;
    }

    @media (max-width: 480px) {
      .change-password-container {
        padding: 30px 20px;
        margin: 10px;
      }

      .header i {
        font-size: 40px;
      }

      .header h2 {
        font-size: 24px;
      }
    }
  </style>
</head>

<body>
  <!-- SVG背景 -->
  <svg
    class="svg-background"
    viewBox="0 0 1440 320"
    preserveAspectRatio="none"
  >
    <path
      class="wave-path"
      fill="rgba(59, 130, 246, 0.4)"
      d="M0,192 C320,300,420,300,740,192 C1060,84,1160,84,1440,192 L1440,320 L0,320 Z"
    ></path>
    <path
      class="wave-path"
      fill="rgba(37, 99, 235, 0.3)"
      d="M0,240 C320,192,420,192,740,240 C1060,360,1160,360,1440,240 L1440,320 L0,320 Z"
    ></path>
    <path
      class="wave-path"
      fill="rgba(29, 78, 216, 0.2)"
      d="M0,160 C320,220,420,220,740,160 C1060,100,1160,100,1440,160 L1440,320 L0,320 Z"
    ></path>
  </svg>

  <div class="change-password-container">
    <div class="header">
      <h2>修改密码</h2>
      <p>请设置您的新密码，确保密码安全强度</p>
    </div>

    <div
      class="success-message"
      id="successMessage"
    >
      <i class="fa fa-check-circle"></i> 密码修改成功！正在跳转...
    </div>

    <form id="changePasswordForm">
      <div class="form-group">
        <label class="form-label">当前密码</label>
        <div class="input-group">
          <input
            type="password"
            class="form-control"
            id="currentPassword"
            placeholder="请输入当前密码"
            required
          >
          <i
            class="fa fa-eye-slash toggle-password"
            data-target="currentPassword"
          ></i>
        </div>
        <div
          class="error-message"
          id="currentPasswordError"
        >请输入当前密码</div>
      </div>

      <div class="form-group">
        <label class="form-label">新密码</label>
        <div class="input-group">
          <input
            type="password"
            class="form-control"
            id="newPassword"
            placeholder="请输入新密码"
            required
          >
          <i
            class="fa fa-eye-slash toggle-password"
            data-target="newPassword"
          ></i>
        </div>
        <div class="password-strength">
          <div
            class="password-strength-bar"
            id="passwordStrengthBar"
          ></div>
        </div>
        <div
          class="strength-text"
          id="passwordStrengthText"
        >密码强度：请输入密码</div>
        <div
          class="password-requirements"
          id="passwordRequirements"
        >
          <div
            class="requirement-item requirement-unmet"
            id="lengthReq"
          >
            <i class="fa fa-times"></i>
            <span>至少8个字符</span>
          </div>
          <div
            class="requirement-item requirement-unmet"
            id="lowercaseReq"
          >
            <i class="fa fa-times"></i>
            <span>包含小写字母 (a-z)</span>
          </div>
          <div
            class="requirement-item requirement-unmet"
            id="uppercaseReq"
          >
            <i class="fa fa-times"></i>
            <span>包含大写字母 (A-Z)</span>
          </div>
          <div
            class="requirement-item requirement-unmet"
            id="numberReq"
          >
            <i class="fa fa-times"></i>
            <span>包含数字 (0-9)</span>
          </div>
          <div
            class="requirement-item requirement-unmet"
            id="specialReq"
          >
            <i class="fa fa-times"></i>
            <span>包含特殊字符 (!@#$%^&*等)</span>
          </div>
        </div>
        <div
          class="error-message"
          id="newPasswordError"
        >密码必须满足以上所有要求</div>
      </div>

      <div class="form-group">
        <label class="form-label">确认新密码</label>
        <div class="input-group">
          <input
            type="password"
            class="form-control"
            id="confirmPassword"
            placeholder="请再次输入新密码"
            required
          >
          <i
            class="fa fa-eye-slash toggle-password"
            data-target="confirmPassword"
          ></i>
        </div>
        <div
          class="error-message"
          id="confirmPasswordError"
        >两次输入的密码不一致</div>
      </div>

      <button
        type="submit"
        class="btn-submit"
        id="submitBtn"
      >
        <i class="fa fa-check"></i> 确认修改
      </button>
    </form>

    <div class="back-link">
      <a href="javascript:history.back()">
        <i class="fa fa-arrow-left"></i> 返回上一页
      </a>
    </div>
  </div>

  <!-- 密码要求提示弹窗 -->
  <div
    class="modal-overlay"
    id="passwordModal"
  >
    <div class="modal-content">
      <div class="modal-header">
        <i class="fa fa-exclamation-triangle"></i>
        <h3>密码不符合要求</h3>
      </div>
      <div class="modal-body">
        <p>您输入的密码不符合安全要求，请确保密码满足以下条件：</p>
        <div class="modal-requirements">
          <div class="requirement-item">
            <i class="fa fa-check"></i>
            <span>至少8个字符</span>
          </div>
          <div class="requirement-item">
            <i class="fa fa-check"></i>
            <span>包含小写字母 (a-z)</span>
          </div>
          <div class="requirement-item">
            <i class="fa fa-check"></i>
            <span>包含大写字母 (A-Z)</span>
          </div>
          <div class="requirement-item">
            <i class="fa fa-check"></i>
            <span>包含数字 (0-9)</span>
          </div>
          <div class="requirement-item">
            <i class="fa fa-check"></i>
            <span>包含特殊字符 (!@#$%^&*等)</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          class="modal-btn"
          onclick="closePasswordModal()"
        >
          <i class="fa fa-check"></i> 我知道了
        </button>
      </div>
    </div>
  </div>

  <!-- 密码不一致提示弹窗 -->
  <div
    class="modal-overlay"
    id="confirmPasswordModal"
  >
    <div class="modal-content">
      <div class="modal-header">
        <i class="fa fa-exclamation-circle"></i>
        <h3>密码不一致</h3>
      </div>
      <div class="modal-body">
        <p>您两次输入的密码不一致，请检查并重新输入。</p>
        <div class="modal-requirements">
          <div class="requirement-item">
            <i class="fa fa-info-circle"></i>
            <span>请确保"新密码"和"确认新密码"输入完全相同</span>
          </div>
          <div class="requirement-item">
            <i class="fa fa-lightbulb-o"></i>
            <span>建议先完成新密码输入，再输入确认密码</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          class="modal-btn"
          onclick="closeConfirmPasswordModal()"
          style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);"
        >
          <i class="fa fa-check"></i> 我知道了
        </button>
      </div>
    </div>
  </div>

  <script>
    // 显示密码要求弹窗
    function showPasswordModal() {
      const modal = document.getElementById('passwordModal');
      modal.style.display = 'flex';
      setTimeout(() => {
        modal.classList.add('show');
      }, 10);
    }

    // 关闭密码要求弹窗
    function closePasswordModal() {
      const modal = document.getElementById('passwordModal');
      modal.classList.remove('show');
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    }

    // 点击弹窗外部关闭
    document.getElementById('passwordModal').addEventListener('click', function (e) {
      if (e.target === this) {
        closePasswordModal();
      }
    });

    // ESC键关闭弹窗
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        closePasswordModal();
      }
    });

    // 密码可见性切换
    document.querySelectorAll('.toggle-password').forEach(icon => {
      icon.addEventListener('click', function () {
        const targetId = this.getAttribute('data-target');
        const input = document.getElementById(targetId);
        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
        input.setAttribute('type', type);
        this.classList.toggle('fa-eye-slash');
        this.classList.toggle('fa-eye');
      });
    });

    // 密码强度检测
    function checkPasswordStrength(password) {
      const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s])[^\s]{8,}$/;

      // 检查各项要求
      const requirements = {
        length: password.length >= 8,
        lowercase: /[a-z]/.test(password),
        uppercase: /[A-Z]/.test(password),
        number: /[0-9]/.test(password),
        special: /[^\w\s]/.test(password)
      };

      // 更新要求显示
      updateRequirementDisplay('lengthReq', requirements.length);
      updateRequirementDisplay('lowercaseReq', requirements.lowercase);
      updateRequirementDisplay('uppercaseReq', requirements.uppercase);
      updateRequirementDisplay('numberReq', requirements.number);
      updateRequirementDisplay('specialReq', requirements.special);

      // 计算满足的要求数量
      const metRequirements = Object.values(requirements).filter(Boolean).length;

      const strengthBar = document.getElementById('passwordStrengthBar');
      const strengthText = document.getElementById('passwordStrengthText');

      strengthBar.className = 'password-strength-bar';

      if (password.length === 0) {
        strengthBar.className = 'password-strength-bar';
        strengthText.textContent = '密码强度：请输入密码';
        return 0;
      } else if (metRequirements < 3) {
        strengthBar.classList.add('strength-weak');
        strengthText.textContent = `密码强度：弱 (${metRequirements}/5项要求)`;
        return 1;
      } else if (metRequirements < 5) {
        strengthBar.classList.add('strength-medium');
        strengthText.textContent = `密码强度：中 (${metRequirements}/5项要求)`;
        return 2;
      } else {
        strengthBar.classList.add('strength-strong');
        strengthText.textContent = '密码强度：强 ✓ 符合所有要求';
        return 3;
      }
    }

    // 更新要求显示状态
    function updateRequirementDisplay(elementId, isMet) {
      const element = document.getElementById(elementId);
      const icon = element.querySelector('i');

      if (isMet) {
        element.className = 'requirement-item requirement-met';
        icon.className = 'fa fa-check';
      } else {
        element.className = 'requirement-item requirement-unmet';
        icon.className = 'fa fa-times';
      }
    }

    // 密码校验函数
    function validatePassword(password) {
      const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s])[^\s]{8,}$/;
      return passwordRegex.test(password);
    }

    // 实时密码强度检测
    document.getElementById('newPassword').addEventListener('input', function () {
      checkPasswordStrength(this.value);
      validatePasswords();
    });

    // 确认密码验证
    document.getElementById('confirmPassword').addEventListener('input', validatePasswords);

    function validatePasswords() {
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const confirmError = document.getElementById('confirmPasswordError');

      if (confirmPassword && newPassword !== confirmPassword) {
        confirmError.style.display = 'block';
        return false;
      } else {
        confirmError.style.display = 'none';
        return true;
      }
    }

    // 表单提交
    document.getElementById('changePasswordForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      // 验证
      let isValid = true;

      // 检查当前密码
      if (!currentPassword) {
        document.getElementById('currentPasswordError').style.display = 'block';
        isValid = false;
      } else {
        document.getElementById('currentPasswordError').style.display = 'none';
      }

      // 检查新密码格式
      if (!validatePassword(newPassword)) {
        document.getElementById('newPasswordError').style.display = 'block';
        isValid = false;
        // 显示密码要求弹窗
        showPasswordModal();
        return; // 直接返回，不继续检查其他项
      } else {
        document.getElementById('newPasswordError').style.display = 'none';
      }

      // 检查密码一致性
      if (!validatePasswords()) {
        isValid = false;
        // 显示密码不一致弹窗
        showConfirmPasswordModal();
        return; // 直接返回，不继续检查其他项
      }

      // 如果当前密码为空，显示简单提示
      if (!currentPassword) {
        alert('请输入当前密码');
        return;
      }

      if (isValid) {
        // 模拟提交
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 处理中...';

        setTimeout(() => {
          document.getElementById('successMessage').style.display = 'block';
          document.getElementById('changePasswordForm').style.display = 'none';

          setTimeout(() => {
            window.location.href = 'index.html';
          }, 2000);
        }, 1500);
      }
    });

    // 显示密码不一致弹窗
    function showConfirmPasswordModal() {
      const modal = document.getElementById('confirmPasswordModal');
      modal.style.display = 'flex';
      setTimeout(() => {
        modal.classList.add('show');
      }, 10);
    }

    // 关闭密码不一致弹窗
    function closeConfirmPasswordModal() {
      const modal = document.getElementById('confirmPasswordModal');
      modal.classList.remove('show');
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    }

    // 点击弹窗外部关闭
    document.getElementById('confirmPasswordModal').addEventListener('click', function (e) {
      if (e.target === this) {
        closeConfirmPasswordModal();
      }
    });

    // 更新ESC键关闭弹窗功能
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        closePasswordModal();
        closeConfirmPasswordModal();
      }
    });
  </script>

  </div>
</body>

</html>